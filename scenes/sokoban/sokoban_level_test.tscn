[gd_scene load_steps=20 format=4 uid="uid://cpv57hirgmyml"]

[ext_resource type="Script" uid="uid://kx0dy58r7pt0" path="res://scenes/sokoban/rules/rule_engine.gd" id="1_1oqcr"]
[ext_resource type="Script" uid="uid://dppvw2f8yh4vu" path="res://scenes/sokoban/board/board_2d.gd" id="1_b0esu"]
[ext_resource type="Script" uid="uid://w1wfv7xac14u" path="res://scenes/sokoban/input/directional_input.gd" id="2_b0esu"]
[ext_resource type="PackedScene" uid="uid://bw2bk7hvohx53" path="res://scenes/sokoban/pieces/sokoban_player.tscn" id="2_d153s"]
[ext_resource type="Script" uid="uid://dbccwvwg28uvs" path="res://scenes/sokoban/board/piece_group.gd" id="3_8hjev"]
[ext_resource type="PackedScene" uid="uid://gujm23k2rxjq" path="res://scenes/sokoban/pieces/sokoban_wall.tscn" id="3_s6jl3"]
[ext_resource type="Script" uid="uid://b42fpsa6w8gka" path="res://scenes/sokoban/rules/sokoban_fragment.gd" id="4_thcny"]
[ext_resource type="Script" uid="uid://dfvfvuuxx5gkf" path="res://scenes/sokoban/rules/sokoban_rule.gd" id="6_gofmd"]
[ext_resource type="PackedScene" uid="uid://bkt7dh5e77c4n" path="res://scenes/sokoban/pieces/sokoban_crate.tscn" id="7_73spk"]

[sub_resource type="Resource" id="Resource_73spk"]
script = ExtResource("3_8hjev")
groups = Array[StringName]([&"player"])
metadata/_custom_type_script = "uid://dbccwvwg28uvs"

[sub_resource type="Resource" id="Resource_ef8tg"]
script = ExtResource("4_thcny")
move_context = 3
group = &"player"
metadata/_custom_type_script = "uid://b42fpsa6w8gka"

[sub_resource type="Resource" id="Resource_thcny"]
script = ExtResource("4_thcny")
move_context = 0
group = &"crate"
metadata/_custom_type_script = "uid://b42fpsa6w8gka"

[sub_resource type="Resource" id="Resource_u3xr1"]
script = ExtResource("4_thcny")
move_context = 3
group = &"player"
metadata/_custom_type_script = "uid://b42fpsa6w8gka"

[sub_resource type="Resource" id="Resource_gofmd"]
script = ExtResource("4_thcny")
move_context = 3
group = &"crate"
metadata/_custom_type_script = "uid://b42fpsa6w8gka"

[sub_resource type="Resource" id="Resource_lye3u"]
script = ExtResource("6_gofmd")
direction = 1
contexts = Array[int]([])
match_pattern = Array[ExtResource("4_thcny")]([SubResource("Resource_ef8tg"), SubResource("Resource_thcny")])
replace_pattern = Array[ExtResource("4_thcny")]([SubResource("Resource_u3xr1"), SubResource("Resource_gofmd")])
metadata/_custom_type_script = "uid://dfvfvuuxx5gkf"

[sub_resource type="TileSetScenesCollectionSource" id="TileSetScenesCollectionSource_ef8tg"]
resource_name = "wall"
scenes/1/scene = ExtResource("3_s6jl3")

[sub_resource type="TileSetScenesCollectionSource" id="TileSetScenesCollectionSource_thcny"]
resource_name = "player"
scenes/1/scene = ExtResource("2_d153s")

[sub_resource type="TileSetScenesCollectionSource" id="TileSetScenesCollectionSource_u3xr1"]
resource_name = "crate"
scenes/1/scene = ExtResource("7_73spk")

[sub_resource type="TileSet" id="TileSet_gofmd"]
tile_size = Vector2i(100, 100)
sources/0 = SubResource("TileSetScenesCollectionSource_ef8tg")
sources/1 = SubResource("TileSetScenesCollectionSource_thcny")
sources/2 = SubResource("TileSetScenesCollectionSource_u3xr1")

[node name="SokobanLevelTest" type="Node2D"]

[node name="RuleEngine" type="Node" parent="." node_paths=PackedStringArray("directional_input", "board")]
script = ExtResource("1_1oqcr")
directional_input = NodePath("DirectionalInput")
board = NodePath("../Board2D")
player_groups = SubResource("Resource_73spk")
rules = Array[ExtResource("6_gofmd")]([SubResource("Resource_lye3u")])

[node name="DirectionalInput" type="Node" parent="RuleEngine"]
script = ExtResource("2_b0esu")
metadata/_custom_type_script = "uid://w1wfv7xac14u"

[node name="Camera2D" type="Camera2D" parent="."]

[node name="Board2D" type="Node2D" parent="."]
script = ExtResource("1_b0esu")
metadata/_custom_type_script = "uid://dppvw2f8yh4vu"

[node name="TileMap" type="TileMapLayer" parent="Board2D"]
position = Vector2(50, 50)
tile_map_data = PackedByteArray("AAD2//r/AAAAAAAAAQD2//v/AAAAAAAAAQD2//z/AAAAAAAAAQD2//3/AAAAAAAAAQD2//7/AAAAAAAAAQD2////AAAAAAAAAQD2/wAAAAAAAAAAAQD2/wEAAAAAAAAAAQD2/wIAAAAAAAAAAQD2/wMAAAAAAAAAAQD2/wQAAAAAAAAAAQD3/wQAAAAAAAAAAQD4/wQAAAAAAAAAAQD5/wQAAAAAAAAAAQD6/wQAAAAAAAAAAQD7/wQAAAAAAAAAAQD8/wQAAAAAAAAAAQD9/wQAAAAAAAAAAQD+/wQAAAAAAAAAAQD//wQAAAAAAAAAAQAAAAQAAAAAAAAAAQABAAQAAAAAAAAAAQACAAQAAAAAAAAAAQADAAQAAAAAAAAAAQAEAAQAAAAAAAAAAQAFAAQAAAAAAAAAAQAGAAQAAAAAAAAAAQAHAAQAAAAAAAAAAQAIAAQAAAAAAAAAAQAIAAMAAAAAAAAAAQAIAAIAAAAAAAAAAQAIAAEAAAAAAAAAAQAIAAAAAAAAAAAAAQAIAP//AAAAAAAAAQAIAP7/AAAAAAAAAQAIAP3/AAAAAAAAAQAIAPz/AAAAAAAAAQAIAPv/AAAAAAAAAQAIAPr/AAAAAAAAAQAHAPr/AAAAAAAAAQAGAPr/AAAAAAAAAQAFAPr/AAAAAAAAAQAEAPr/AAAAAAAAAQADAPr/AAAAAAAAAQACAPr/AAAAAAAAAQABAPr/AAAAAAAAAQAAAPr/AAAAAAAAAQD///r/AAAAAAAAAQD+//r/AAAAAAAAAQD9//r/AAAAAAAAAQD8//r/AAAAAAAAAQD7//r/AAAAAAAAAQD6//r/AAAAAAAAAQD5//r/AAAAAAAAAQD4//r/AAAAAAAAAQD3//r/AAAAAAAAAQD/////AQAAAAAAAQADAP3/AgAAAAAAAQD6/wIAAgAAAAAAAQD6//z/AgAAAAAAAQA=")
tile_set = SubResource("TileSet_gofmd")
