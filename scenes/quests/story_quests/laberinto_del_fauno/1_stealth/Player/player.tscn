[gd_scene load_steps=28 format=3 uid="uid://cgecv3j2usijt"]

[ext_resource type="Texture2D" uid="uid://bhnp4agy8kox2" path="res://scenes/game_elements/characters/player/components/storyweaver_yellow_idle.png" id="1_03v3g"]
[ext_resource type="Texture2D" uid="uid://bpfftom0yxqjk" path="res://scenes/game_elements/characters/player/components/storyweaver_yellow_walk.png" id="2_42co5"]

[sub_resource type="GDScript" id="GDScript_cco3e"]
script/source = "extends CharacterBody2D

@export_category(\"Principal Variables\")
@export var velocidad_base: int = 100
@export var dano: int = 1
@export var multiplicador_correr: float = 2.5
@export var recarga_stamina_rate: float = 0.5

const LERP_SPEED = 0.15
const ESCALA_NORMAL = 6.5
const ESCALA_CORRER = 3.5

var esta_corriendo: bool = false
var puede_recargar_stamina: bool = false
var velocidad_actual: float = 0.0

func _ready() -> void:
	velocidad_actual = float(velocidad_base)

func _process(_delta: float) -> void:
	Movimiento()
	
	var target_scale: float
	if esta_corriendo:
		target_scale = ESCALA_CORRER
	else:
		target_scale = ESCALA_NORMAL

	$Light/Light.texture_scale = lerp($Light/Light.texture_scale, target_scale, LERP_SPEED)

func Movimiento() -> void:
	var direccion: Vector2 = Input.get_vector(\"move_left\", \"move_right\", \"move_up\", \"move_down\")
	
	esta_corriendo = false

	if Input.is_action_pressed(\"running\") and direccion != Vector2.ZERO and $Stamina/StaminaBar.value > 0:
		$Stamina/StaminaBar.value -= 0.5
		velocidad_actual = velocidad_base * multiplicador_correr
		esta_corriendo = true
		$ReloadStamina.stop()
		puede_recargar_stamina = false
		
	else:
		velocidad_actual = float(velocidad_base)
		
		if Input.is_action_just_released(\"running\") and not esta_corriendo:
			$ReloadStamina.start()
			
		if puede_recargar_stamina == true:
			$Stamina/StaminaBar.value += recarga_stamina_rate

	animacion(direccion)
	velocity = direccion * velocidad_actual
	move_and_slide()

func animacion(direccion: Vector2) -> void:
	if direccion == Vector2(0,0):
		$Animacion.play(\"Idle\")
	elif esta_corriendo:
		$Animacion.play(\"Run\") 
	else:
		$Animacion.play(\"Walk\")
	
	if direccion.x < 0:
		$Animacion.flip_h = true
		$HitBox.scale.x = -1
		$Collision.scale.x = -1
		$Light.scale.x = -1
	elif direccion.x > 0:
		$Animacion.flip_h = false
		$HitBox.scale.x = 1
		$Collision.scale.x = 1
		$Light.scale.x = 1


func _on_reload_stamina_timeout() -> void:
	puede_recargar_stamina = true


func _on_minigame_1_body_entered(_body: Node2D) -> void:
	velocidad_base = 100


func _on_minigame_1_body_exited(_body: Node2D) -> void:
	velocidad_base = 200
"

[sub_resource type="AtlasTexture" id="AtlasTexture_86gje"]
atlas = ExtResource("1_03v3g")
region = Rect2(0, 0, 192, 192)

[sub_resource type="AtlasTexture" id="AtlasTexture_y51gy"]
atlas = ExtResource("1_03v3g")
region = Rect2(192, 0, 192, 192)

[sub_resource type="AtlasTexture" id="AtlasTexture_i4rlt"]
atlas = ExtResource("1_03v3g")
region = Rect2(384, 0, 192, 192)

[sub_resource type="AtlasTexture" id="AtlasTexture_o0rv6"]
atlas = ExtResource("1_03v3g")
region = Rect2(576, 0, 192, 192)

[sub_resource type="AtlasTexture" id="AtlasTexture_rs1ap"]
atlas = ExtResource("1_03v3g")
region = Rect2(768, 0, 192, 192)

[sub_resource type="AtlasTexture" id="AtlasTexture_8tcr6"]
atlas = ExtResource("1_03v3g")
region = Rect2(960, 0, 192, 192)

[sub_resource type="AtlasTexture" id="AtlasTexture_n2idj"]
atlas = ExtResource("1_03v3g")
region = Rect2(1152, 0, 192, 192)

[sub_resource type="AtlasTexture" id="AtlasTexture_5825l"]
atlas = ExtResource("1_03v3g")
region = Rect2(1344, 0, 192, 192)

[sub_resource type="AtlasTexture" id="AtlasTexture_ajiq7"]
atlas = ExtResource("1_03v3g")
region = Rect2(1536, 0, 192, 192)

[sub_resource type="AtlasTexture" id="AtlasTexture_cyf08"]
atlas = ExtResource("1_03v3g")
region = Rect2(1728, 0, 192, 192)

[sub_resource type="AtlasTexture" id="AtlasTexture_dqwo4"]
atlas = ExtResource("2_42co5")
region = Rect2(0, 0, 192, 192)

[sub_resource type="AtlasTexture" id="AtlasTexture_cj1t6"]
atlas = ExtResource("2_42co5")
region = Rect2(192, 0, 192, 192)

[sub_resource type="AtlasTexture" id="AtlasTexture_2t3r2"]
atlas = ExtResource("2_42co5")
region = Rect2(384, 0, 192, 192)

[sub_resource type="AtlasTexture" id="AtlasTexture_ufwcx"]
atlas = ExtResource("2_42co5")
region = Rect2(576, 0, 192, 192)

[sub_resource type="AtlasTexture" id="AtlasTexture_eyeuj"]
atlas = ExtResource("2_42co5")
region = Rect2(768, 0, 192, 192)

[sub_resource type="AtlasTexture" id="AtlasTexture_c1asy"]
atlas = ExtResource("2_42co5")
region = Rect2(960, 0, 192, 192)

[sub_resource type="SpriteFrames" id="SpriteFrames_phcj5"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_86gje")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_y51gy")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_i4rlt")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_o0rv6")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_rs1ap")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_8tcr6")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_n2idj")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_5825l")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ajiq7")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_cyf08")
}],
"loop": true,
"name": &"Idle",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_dqwo4")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_cj1t6")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_2t3r2")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ufwcx")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_eyeuj")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_c1asy")
}],
"loop": true,
"name": &"Walk",
"speed": 5.0
}]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_lacgx"]
size = Vector2(45, 44)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_jhpdc"]
size = Vector2(37, 7)

[sub_resource type="Gradient" id="Gradient_03v3g"]
offsets = PackedFloat32Array(0, 0.6861538)
colors = PackedColorArray(0.8545453, 0.8545453, 0.8545453, 1, 0, 0, 0, 1)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_42co5"]
gradient = SubResource("Gradient_03v3g")
width = 100
height = 100
use_hdr = true
fill = 1
fill_from = Vector2(0.5, 0.5)

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_cco3e"]
blend_mode = 1
light_mode = 2

[sub_resource type="Gradient" id="Gradient_42co5"]
offsets = PackedFloat32Array(0, 0.7476923)
colors = PackedColorArray(1, 1, 1, 1, 0, 0, 0, 1)

[sub_resource type="GradientTexture2D" id="GradientTexture2D_y51gy"]
gradient = SubResource("Gradient_42co5")
fill = 1
fill_from = Vector2(0.5, 0.5)

[node name="Player" type="CharacterBody2D"]
collision_mask = 402
script = SubResource("GDScript_cco3e")

[node name="Animacion" type="AnimatedSprite2D" parent="."]
sprite_frames = SubResource("SpriteFrames_phcj5")
animation = &"Idle"
frame_progress = 0.25442263

[node name="HitBox" type="Area2D" parent="."]
position = Vector2(0.5, 16.5)
collision_layer = 64
collision_mask = 256

[node name="CollisionShape2D" type="CollisionShape2D" parent="HitBox"]
position = Vector2(-2, -20.5)
shape = SubResource("RectangleShape2D_lacgx")
debug_color = Color(0.9849536, 0, 0.34310836, 0.41960785)

[node name="Collision" type="CollisionShape2D" parent="."]
position = Vector2(0.5, 16.5)
shape = SubResource("RectangleShape2D_jhpdc")

[node name="Stamina" type="CanvasLayer" parent="."]

[node name="StaminaBar" type="ProgressBar" parent="Stamina"]
anchors_preset = 1
anchor_left = 1.0
anchor_right = 1.0
offset_left = -350.0
offset_bottom = 60.0
grow_horizontal = 0
size_flags_horizontal = 8
max_value = 300.0
value = 300.0

[node name="Camera2D" type="Camera2D" parent="."]

[node name="ReloadStamina" type="Timer" parent="."]
one_shot = true

[node name="Light" type="Node2D" parent="."]

[node name="Light" type="PointLight2D" parent="Light"]
position = Vector2(35, -20)
texture = SubResource("GradientTexture2D_42co5")
texture_scale = 5.0

[node name="Sprite2D" type="Sprite2D" parent="Light/Light"]
modulate = Color(0.57144064, 0.5615486, 0.12771055, 0.30980393)
material = SubResource("CanvasItemMaterial_cco3e")
position = Vector2(1, 2)
texture = SubResource("GradientTexture2D_y51gy")

[connection signal="timeout" from="ReloadStamina" to="." method="_on_reload_stamina_timeout"]
